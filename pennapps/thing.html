<!DOCTYPE html>
<html>
<head>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" type="text/javascript"></script>
  <script src="http://www.skulpt.org/static/skulpt.min.js" type="text/javascript"></script>
  <script src="http://www.skulpt.org/static/skulpt-stdlib.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js" type="text/javascript" charset="utf-8"></script>
  <script src="filereader.js" charset="utf-8"></script>
  <script src="parse.js"></script>
  <link type="text/css" rel="stylesheet" href="main.css">
  <script src = "draggable.js"></script>
  <script src = "panels.js"></script>
  <script src = "saving.js"></script>
</head>
<body>
  <div class="header">
    <img src="OCTO-CAT.png" style="height: 50px;"></img>
    <h1 style="display:inline;font-size:4em;">blockat</h1>
  </div>
  <div class="clearfix">
    <div class="column content" style="text-align:right; width: 10%; background-color: #DDDDDD">
      <h3>&nbsp;</h3>
      <p onclick="showpanel('basic',this)" class = "sidebtn" id = "firstbtn" onload="showpanel('basic')">Basic</p>
      <p onclick="showpanel('flowcontrol',this)" class = "sidebtn">Flow Control</p>
      <p onclick="showpanel('primitives',this)" class = "sidebtn">Primitives</p>
      <p onclick="showpanel('logic',this)" class = "sidebtn">Logic</p>
      <p onclick="showpanel('math',this)" class = "sidebtn">Math</p>
      <p onclick="showpanel('group',this)" class = "sidebtn">Groups</p>
      <p onclick="showpanel('uwedefined',this)" class = "sidebtn">User-Defined</p>
    </div>
    <div class="column content" style="width: 30%;">
      <h3>Templates</h3>
      <div id="semidraggablecontainer" style="position:relative">
        <div class="bottom panel" id="basic">
          <div class = "semidraggable red">&nbsp;&nbsp;&nbsp;&nbsp;</div><br>
          <div class = "semidraggable green">
            print(
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            )
            <br>
          </div>
          <div class="semidraggable blue">
            input(
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            )
            <br>
          </div>
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            ,&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
        </div>
        <div class="bottom panel" id="flowcontrol">
          <div class = "semidraggable green endswithcolon">
            if&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            :
            <br>
          </div>
          <div class = "semidraggable green endswithcolon">
            else&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            :
            <br>
          </div>
          <div class = "semidraggable green endswithcolon">
            elif&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            :
            <br>
          </div>
          <div class = "semidraggable green endswithcolon">
            while&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            :
            <br>
          </div>
          <div class = "semidraggable green endswithcolon">
            for&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            &nbsp;in&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            :
            <br>
          </div>
          <div class = "semidraggable blue">
            range(
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            )
          </div>
          <br>
          <div class = "semidraggable green">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            &nbsp;=&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            <br>
          </div>
          <div class = "semidraggable green">
            <span>return</span>
            <br>
          </div>
          <div class="semidraggable green">
            <span>break</span>
            <br>
          </div>
        </div>
        <div class="bottom panel" id="math">
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            &nbsp;+&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            &nbsp;-&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            &nbsp;==&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            &nbsp;%&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            &nbsp;*&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            &nbsp;/&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            &nbsp;<&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            &nbsp;>&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            &nbsp;<=&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            &nbsp;>=&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
        </div>
        <div class="bottom panel" id="logic">
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            &nbsp;in&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            &nbsp;not in&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            &nbsp;==&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            &nbsp;and&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            &nbsp;or&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
          <div class="semidraggable blue">
            not&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
        </div>
        <div class="bottom panel" id="primitives">
          <div class = "semidraggable blue">
            <input type="number" style = "width:5em;" placeholder="num"></input>
          </div>
          <br>
          <div class = "semidraggable blue">
            &quot;<input type="text" style = "width:5em;" placeholder="string"></input>&quot;
          </div>
          <br>
          <!-- rip this...maybe revisit later
          <div class = "semidraggable blue">
            &nbsp;<input type="checkbox" onclick="updateCheckbox()"></input>&nbsp;
            <span id="bool">false</span>
          </div>
          <br>
          -->
          <div class="semidraggable blue">
            <span>False</span>
          </div>
          <br>
          <div class="semidraggable blue">
            <span>True</span>
          </div>
          <br>
        </div>
        <div class="bottom panel" id="group">
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            ,&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            :&nbsp;
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
          <div class = "semidraggable blue">
            [
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            ]
          </div>
          <br>
          <div class = "semidraggable blue">
            {
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            }
          </div>
          <br>
          <div class = "semidraggable blue">
            (
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            )
          </div>
          <br>
        </div>
        <div class="bottom panel" id="uwedefined">
          <div class = "semidraggable green endswithcolon">
            def&nbsp;<input type="text" style="width:5em;" placeholder="func"></input>(
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            ):
            <br>
          </div>
          <div class = "semidraggable blue">
            <div class="draggable blue"><input type="text" style="width:5em;" placeholder="var"></input></div>
          </div>
          <br>
          <div class = "semidraggable green endswithcolon">
            class&nbsp;<input type="text" style="width:5em;" placeholder="class"></input>
            :
            <br>
          </div>
          <div class = "semidraggable green">
            import&nbsp;
            <input type="text" style="width:5em;" placeholder="module"></input>
            <br>
          </div>
          <div class = "semidraggable blue">
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            .
            <div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
          </div>
          <br>
          <div class = "semidraggable green">
            <input type="text" style="width:5em;" placeholder="func"></input>
            (<div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>)
            <br>
          </div>
          <div class = "semidraggable blue">
            <input type="text" style="width:5em;" placeholder="func"></input>
            (<div class="draggable blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>)
          </div>
          <br>
          <div class = "semidraggable green">
            <input type="text" style="width:20em;" placeholder="custom line"></input>
            <br>
          </div>
          <div class = "semidraggable blue">
            <input type="text" style="width:20em;" placeholder="custom line"></input>
          </div>
          <br>
          <div class = "semidraggable green">
            #&nbsp;&nbsp;<input type="text" style="width:20em;" placeholder="comment"></input>
            <br>
          </div>
        </div>
      </div>
    </div>
    <div class="column content" style="width: 30%;">
      <h3>Blocks</h3>
      <button type="button" onclick="saveblocks()">Save Blocks</button>
      <input type="file" id="loadblocks"></input>
      <button type="button" onclick="block_to_code(); runit();">Convert to Code</button><br>
      <div id="draggablecontainer" style="text-align: left;">
        <div class = "draggable green">
          print(
          <div class = "draggable blue">
            &nbsp;<input type="number" style = "width:5em;" placeholder="num" value="65"></input>&nbsp;
          </div>
          )
          <br>
        </div>
      </div>
    </div>
    <div class="column content" style="width: 30%;">
      <h3>Code</h3>
      Output:
      <pre id="output" style="border: 1px solid grey; text-align: left; padding: 2px;">65</pre>
      <button type="button" onclick="runit()">Run Code</button>
      <input type="button" id="dwn-btn" value="Download Code"/>
      <div id="editor" class="editor-window">print(65)</div>
      <script>
      var editor = ace.edit("editor");
      editor.setTheme("ace/theme/cobalt");
      editor.getSession().setMode("ace/mode/python");
      </script>
    </div>
  </div>
  <script>
  //download editor contents as .py file
  function download(filename, text) {
    var element = document.createElement('a');
    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    element.setAttribute('download', filename);
    element.style.display = 'none';
    document.body.appendChild(element);
    element.click();
    document.body.removeChild(element);
  }
  document.getElementById("dwn-btn").addEventListener("click", function(){
    var text = editor.getValue();
    var filename = "script.py";
    download(filename, text);
  }, false);
  </script>
  <div class="footer">
    <p>This is a project for PennApps XVI by Sam Uwe Alws and Eric Zheng.</p>
    <p>Check out our <a href="https://github.com/orangebaron/pennapps">Github repo</a> for more!</p>
  </div>
  <script type="text/javascript">
  Sk.externalLibraries = {
    numpy: {
      path: "https://raw.githubusercontent.com/waywaaard/skulpt_numpy/master/numpy/__init__.js"
    }
  }
  function outf(text) {
    var mypre = document.getElementById("output");
    mypre.innerHTML = mypre.innerHTML + text;
  }
  function builtinRead(x) {
    if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
    throw "File not found: '" + x + "'";
    return Sk.builtinFiles["files"][x];
  }
  function runit() {
    var prog = editor.getValue();
    var mypre = document.getElementById("output");
    mypre.innerHTML = '';
    Sk.pre = "output";
    Sk.configure({output:outf, read:builtinRead});
    (Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'mycanvas';
    var myPromise = Sk.misceval.asyncToPromise(function() {
      return Sk.importMainWithBody("<stdin>", false, prog, true);
    });
    myPromise.then(function(mod) {
      console.log('success');
    },
    function(err) {
      console.log(err.toString());
    });
  }
  function get_html() {
    var inputs = document.getElementById("draggablecontainer").getElementsByTagName("input");
    for (var i = 0;i<inputs.length;i++) {
      //add a temporary span that has the value as innerhtml
      var elem = inputs.item(i);
      var s = document.createElement("span");
      s.innerHTML = elem.value;
      elem.parentElement.insertBefore(s,elem);
      s.className = "temporary";
    }
    var returnVal = document.getElementById("draggablecontainer").innerHTML;
    var temps = document.getElementById("draggablecontainer").getElementsByClassName("temporary");
    while (temps.length > 0) {
      //delete all the temporary crap we made before
      var elem = temps.item(0);
      elem.parentElement.removeChild(elem);
      temps = document.getElementById("draggablecontainer").getElementsByClassName("temporary");
    }
    return returnVal;
  }
  function block_to_code() {
    editor.setValue(parse(get_html()));
  }
  function updateCheckbox() {
    if (document.querySelector("input[type=checkbox]").checked) {
      document.getElementById("bool").innerHTML = "true";
    } else {
      document.getElementById("bool").innerHTML = "false";
    }
  }
  FileReaderJS.setupInput(document.getElementById("loadblocks"), {
    readAsDefault: "DataURL",
    on: {
      load: function(e, file) {
        document.getElementById("draggablecontainer").innerHTML =
          window.atob(e.target.result.substring(22));
        registerdragevents();
        window.setTimeout(function(){document.getElementById("loadblocks").value = "";},
          3000);
      }
    }
  });
  showpanel("basic");
  registerdragevents();
  registersemidragevents();
  </script>
</body>
</html>
